<div id="add-subtract-form">
    <form action="{% url 'ims:site_detail' siteId=site.number  %}" method="post">
        {% csrf_token %}
        {% if site.num_inventory_errors > 0 %}
            Inventory Items With Errors: {{ site.num_inventory_errors }}
        {% endif %}
        <table id="inventory-detail-form">
        {{ inventoryAddSubtractForms.management_form }}
        {% for inventoryForm in inventoryAddSubtractForms %}
            {% if forloop.first %}
                <thead>
                    <tr class="detail-form-header">
                        <th colspan='6'>
                            {% if canAdd %}
                                <input title="add new products to site inventory" class="cell-left-btn" type="submit" value="Add New Inventory" name="Add New Inventory">
                            {% endif %}
                            {% if canChangeInventory and canDelete %}
                                <input title="save changes to checked inventory items" class="cell-right-btn" type="submit" value="Save Changes" name="Save Add Subtract Changes">
                            {% endif %}
                        </th>
                    </tr>
                    <tr class="detail-form-header">
                        <th>Item</th>
                        {% for field in inventoryForm.visible_fields %}
                            <th>{{ field.label }}</th>
                        {% endfor %}
                        <th>Quantity</th>
                        <th>
                            History
                        </th>
                    </tr>
                </thead>
            {% endif %}
            <tr class={% if forloop.counter0  >= startRow and forloop.counter <= stopRow %}
                    "detail-table-row-visible"
                {% else %}
                    "detail-table-row-invisible"
                {% endif %}>
                <td class=
                {% if inventoryForm.instance.check_quantity %}
                    "detail-table-text cell-left"
                {% else %}
                    "detail-table-error-text cell-left"
                {% endif %}
                ><a class="pkt-link" href="{% url 'ims:product_detail' code=inventoryForm.instance.information.code page=1%}"
                 title="{% if inventoryForm.instance.check_information %}edit item details{% else %}edit item details, this product has errors the need to be corrected{% endif %}">
                {{ inventoryForm.instance.information }}
                </a></td>
                {% for field in inventoryForm.visible_fields %}
                    <td class="{{ field.css_classes }} cell-left" title="{{ field.errors | escape}}">
                        {# Include the hidden fields in the form #}
                        {% if forloop.first %}
                            {% for hidden in inventoryForm.hidden_fields %}
                                {{ hidden }}
                            {% endfor %}
                        {% endif %}
                        {% if field.errors %}
                            <span>{{ field.errors }}</span>&nbsp;
                        {% endif %}
                        {{ field }}
                    </td>
                {% endfor %}
                <td>{{ inventoryForm.instance.quantity }}</td>
                <td>
                    {% if inventoryForm.instance.inventory_history_count >= 1 %}
                    <a title="history of inventory changes at this site for this product"
                    href="{% url 'ims:inventory_history' siteId=site.pk code=inventoryForm.instance.information.code page=1 %}">
                        history
                    </a> ({{ inventoryForm.instance.inventory_history_count }})
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </table>
    </form>
</div>